Object.size=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};function roundNumber(a,b){var c=String(Math.round(a*Math.pow(10,b))/Math.pow(10,b));for(c.indexOf(".")<0&&(c+=".");c.length-c.indexOf(".")<=b;)c+="0";return c}
jQuery.fn.flash=function(a,b){typeof this.data("flashing")=="undefined"&&this.data("flashing",!1);if(this.data("flashing")!=!0){var c=this.css("background-color");this.data("flashing",!0);this.animate({backgroundColor:a},b/2);var e=this;this.animate({backgroundColor:c},b/2,function(){e.data("flashing",!1)})}};
jQuery.fn.fadeOutFlash=function(a,b){typeof this.data("flashing")=="undefined"&&this.data("flashing",!1);if(this.data("flashing")!=!0){var c=this.css("background-color");this.data("flashing",!0);this.css("background-color",a);var e=this;this.animate({backgroundColor:c},b,function(){e.data("flashing",!1)})}};new function(){$.browser.eveIGB=!1;if(navigator.appVersion.indexOf("EVE-IGB")!=-1)$.browser.eveIGB=!0};
function setCookie(a,b,c){if(c){var e=new Date;e.setTime(e.getTime()+c*864E5);c="; expires="+e.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"}function getCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var e=b[c];e.charAt(0)==" ";)e=e.substring(1,e.length);if(e.indexOf(a)==0)return e.substring(a.length,e.length)}return null}function CountUp(a,b){this.beginDate=new Date(a);this.container=$(b);this.calculate()}
CountUp.prototype.addLeadingZero=function(a){return a<10?"0"+a:a};
CountUp.prototype.calculate=function(){var a=new Date;dd=a-this.beginDate;this.days=Math.floor(dd/864E5*1);this.hours=Math.floor(dd%864E5/36E5*1);if(this.days<2)this.minutes=Math.floor(dd%864E5%36E5/6E4*1),this.seconds=Math.floor(dd%864E5%36E5%6E4/1E3*1),this.seconds=this.addLeadingZero(this.seconds),this.minutes=this.addLeadingZero(this.minutes);this.hours=this.addLeadingZero(this.hours);this.days==0?this.container.text(this.hours+":"+this.minutes+":"+this.seconds):this.container.text(this.days+
"d "+this.hours+"h");if(this.days<2){var b=this;setTimeout(function(){b.calculate()},1E3)}delete a;a=null};function pad(a,b){for(var c=""+a;c.length<b;)c="0"+c;return c}
var magsLookup={1:{0:"",1:"Forgotten Perimeter Amplifier",2:"Forgotten Perimeter Power Array"},2:{0:"",1:"Forgotten Perimeter Gateway",2:"Forgoten Perimeter Habitation Coils"},3:{0:"",1:"Forgotten Frontier Quarantine Outpost",2:"Forgotten Frontier Recursive Depot"},4:{0:"",1:"Forgotten Frontier Conversion Module",2:"Forgotten Frontier Evacuation Center"},5:{0:"",1:"Forgotten Core Data Field",2:"Forgotten Core Information Pen"},6:{0:"",1:"Forgotten Core Assembly Hall",2:"Forgotten Circuitry Disassembler"},
7:{0:""},8:{0:""},9:{0:""}},radarsLookup={1:{0:"",1:"Unsecured Perimeter Amplifier",2:"Unsecured Perimeter Information Center"},2:{0:"",1:"Unsecured Perimeter Comms Relay",2:"Unsecured Transponder Farm"},3:{0:"",1:"Unsecured Frontier Database",2:"Unsecured Frontier Receiver"},4:{0:"",1:"Unsecured Frontier Digital Nexus",2:"Unsecured Frontier Trinary Hub"},5:{0:"",1:"Unsecured Frontier Enclave Relay",2:"Unsecured Frontier Server Bank"},6:{0:"",1:"Unsecured Core Backup Array",2:"Unsecured Core Emergence"},
7:{0:""},8:{0:""},9:{0:""}},gravsLookup={0:"",1:"Average Frontier Deposit",2:"Unexceptional Frontier Deposit",3:"Common Perimeter Deposit",4:"Exceptional Core Deposit",5:"Infrequent Core Deposit",6:"Unusual Core Deposit",7:"Rarified Core Deposit",8:"Ordinary Perimeter Deposit",9:"Uncommon Core Deposit",10:"Isolated Core Deposit"},ladarsLookup={0:"",1:"Barren Perimeter Reservoir",2:"Minor Perimeter Reservoir",3:"Ordinary Perimeter Reservoir",4:"Sizable Perimeter Reservoir",5:"Token Perimeter Reservoir",
6:"Bountiful Frontier Reservoir",7:"Vast Frontier Reservoir",8:"Instrumental Core Reservoir",9:"Vital Core Reservoir"},whLookup={1:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:"H121 (to C1)",8:"C125  (to C2)",9:"O883 (to C3)",10:"  (to C4)",11:"L614 (to C5)",12:"S804 (to C6)",13:"Z060 (to Nullsec)",14:"J244 (to Lowsec)",15:"N110 (to Highsec)"},2:{0:"Unstable Wormhole",
1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:"Z647 (to C1)",8:"D382 (to C2)",9:"O477 (to C3)",10:"Y683 (to C4)",11:"N062 (to C5)",12:"R474 (to C6)",13:"E545 (to Nullsec)",14:"A239 (to Lowsec)",15:"B274 (to Highsec)"},3:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",
7:"V301 (to C1)",8:"I182 (to C2)",9:"N968 (to C3)",10:"T405 (to C4)",11:"N770 (to C5)",12:"A982 (to C6)",13:"K346 (to Nullsec)",14:"U210 (to Lowsec)",15:"D845 (to Highsec)"},4:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:"P060 (to C1)",8:"N766 (to C2)",9:"C247 (to C3)",10:"X877 (to C4)",11:"H900 (to C5)",12:"U574 (to C6)",13:" (to Nullsec)",14:"  (to Lowsec)",
15:"  (to Highsec)"},5:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:"Y790 (to C1)",8:"D364 (to C2)",9:"M267 (to C3)",10:"E175 (to C4)",11:"H296 (to C5)",12:"V753 (to C6)",13:"Z142 (to Nullsec)",14:"C140 (to Lowsec)",15:"D792 (to Highsec)"},6:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",
5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:"Q317  (to C1)",8:"G024 (to C2)",9:"L477 (to C3)",10:"Z457 (to C4)",11:"V911 (to C5)",12:"W237 (to C6)",13:"Z142 (to Nullsec)",14:"C140 (to Lowsec)",15:"D792  (to Highsec)"},7:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:"Z971 (to C1)",8:"R943 (to C2)",9:"X702 (to C3)",10:" (to C4)",11:"M555 (to C5)",12:"  (to C6)",
13:" (to Nullsec)",14:" (to Lowsec)",15:"A641 (to Highsec)"},8:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:" (to C1)",8:"  (to C2)",9:"X702 (to C3)",10:"  (to C4)",11:"N432 (to C5)",12:"  (to C6)",13:"  (to Nullsec)",14:"  (to Lowsec)",15:"  (to Highsec)"},9:{0:"Unstable Wormhole",1:"K162 (from Unknown)",2:"K162 (from Dangerous unknown)",3:"K162 (from Deadly unknown)",
4:"K162 (from Nullsec)",5:"K162 (from Lowsec)",6:"K162 (from Highsec)",7:"Z971 (to C1)",8:"R943 (to C2)",9:"X702 (to C3)",10:"  (to C4)",11:"N432 (to C5)",12:"  (to C6)",13:"S199 (to Nullsec)",14:"N944 (to Lowsec)",15:"B449 (to Highsec)"}},blackHoleEffects={1:[["Inertia","+25%"],["Targeting Range","-10%"],["Falloff","-10%"],["Missile Velocity","-10%"],["Ship Velocity","+25%"],["Drone control Range","-10%"]],2:[["Inertia","+44%"],["Targeting Range","-19%"],["Falloff","-19%"],["Missile Velocity","-19%"],
["Ship Velocity","+44%"],["Drone control Range","-19%"]],3:[["Inertia","+55%"],["Targeting Range","-27%"],["Falloff","-27%"],["Missile Velocity","-27%"],["Ship Velocity","+55%"],["Drone control Range","-27%"]],4:[["Inertia","+68%"],["Targeting Range","-34%"],["Falloff","-34%"],["Missile Velocity","-34%"],["Ship Velocity","+68%"],["Drone control Range","-34%"]],5:[["Inertia","+85%"],["Targeting Range","-41%"],["Falloff","-41%"],["Missile Velocity","-41%"],["Ship Velocity","+85%"],["Drone control Range",
"-41%"]],6:[["Inertia","+100%"],["Targeting Range","-50%"],["Falloff","-50%"],["Missile Velocity","-50%"],["Ship Velocity","+66%"],["Drone control Range","-50%"]]},wolfRayetEffects={1:[["Armor Resists","+10%"],["Shield Resists","-10%"],["Small Weapon Damage","+25%"],["Signature Size","-10%"]],2:[["Armor Resists","+18%"],["Shield Resists","-18%"],["Small Weapon Damage","+44%"],["Signature Size","-19%"]],3:[["Armor Resists","+22%"],["Shield Resists","-22%"],["Small Weapon Damage","+55%"],["Signature Size",
"-27%"]],4:[["Armor Resists","+27%"],["Shield Resists","-27%"],["Small Weapon Damage","+68%"],["Signature Size","-34%"]],5:[["Armor Resists","+34%"],["Shield Resists","-34%"],["Small Weapon Damage","+85%"],["Signature Size","-41%"]],6:[["Armor Resists","+50%"],["Shield Resists","-50%"],["Small Weapon Damage","+100%"],["Signature Size","-50%"]]},redGiantEffects={1:[["Heat Damage","+10%"],["Overheat Bonus","+25%"],["Smart Bomb Range","+25%"],["Smart Bomb Damage","+25%"]],2:[["Heat Damage","+18%"],["Overheat Bonus",
"+44%"],["Smart Bomb Range","+44%"],["Smart Bomb Damage","+44%"]],3:[["Heat Damage","+22%"],["Overheat Bonus","+55%"],["Smart Bomb Range","+55%"],["Smart Bomb Damage","+55%"]],4:[["Heat Damage","+27%"],["Overload Bonus","+68%"],["Smart Bomb Range","+68%"],["Smart Bomb Damage","+68%"]],5:[["Heat Damage","+34%"],["Overheat Bonus","+85%"],["Smart Bomb Range","+85%"],["Smart Bomb Damage","+85%"]],6:[["Heat Damage","+50%"],["Overheat Bonus","+100%"],["Smart Bomb Range","+100%"],["Smart Bomb Damage","+100%"]]},
catacylsmicEffects={1:[["Armor Repair","-10%"],["Shield Boost","-10%"],["Shield Transfer","+25%"],["Remote Repair","+25%"],["Capacitor capacity","+25%"],["Capacitor recharge time","+25%"]],2:[["Armor Repair","-19%"],["Shield Boost","-19%"],["Shield Transfer","+44%"],["Remote Repair","+44%"],["Capacitor capacity","+44%"],["Capacitor recharge time","+44%"]],3:[["Armor Repair","-27%"],["Shield Boost","-27%"],["Shield Transfer","+55%"],["Remote Repair","+55%"],["Capacitor capacity","+55%"],["Capacitor recharge time",
"+55%"]],4:[["Armor Repair","-34%"],["Shield Boost","-34%"],["Shield Transfer","+68%"],["Remote Repair","+68%"],["Capacitor capacity","+68%"],["Capacitor recharge time","+68%"]],5:[["Armor Repair","-41%"],["Shield Boost","-41%"],["Shield Transfer","+85%"],["Remote Repair","+85%"],["Capacitor capacity","+85%"],["Capacitor recharge time","+85%"]],6:[["Armor Repair","-50%"],["Shield Boost","-50%"],["Shield Transfer","+100%"],["Remote Repair","+100%"],["Capacitor capacity","+100%"],["Capacitor recharge time",
"+100%"]]},magnetarEffects={1:[["Damage","+25%"],["Missile Explosion Velocity","-10%"],["Drone Velocity","-10%"],["Targeting Range","-10%"],["Targeting Speed","-10%"]],2:[["Damage","+44%"],["Missile Explosion Velocity","-19%"],["Drone Velocity","-19%"],["Targeting Range","-19%"],["Targeting Speed","-19%"]],3:[["Damage","+55%"],["Missile Explosion Velocity","-27%"],["Drone Velocity","-27%"],["Targeting Range","-27%"],["Targeting Speed","-27%"]],4:[["Damage","+68%"],["Missile Explosion Velocity","-34%"],
["Drone Velocity","-34%"],["Targeting Range","-34%"],["Targeting Speed","-34%"]],5:[["Damage","+85%"],["Missile Explosion Velocity","-41%"],["Drone Velocity","-41%"],["Targeting Range","-41%"],["Targeting Speed","-41%"]],6:[["Damage","+100%"],["Missile Explosion Velocity","-50%"],["Drone Velocity","-50%"],["Targeting Range","-50%"],["Targeting Speed","-50%"]]},pulsarEffects={1:[["Shield HP","+25%"],["Armor Resists","-10%"],["Capacitor recharge time","-10%"],["Targeting Range","+25%"],["Signature Size",
"+25%"]],2:[["Shield HP","+44%"],["Armor Resists","-18%"],["Capacitor recharge time","-19%"],["Targeting Range","+44%"],["Signature Size","+44%"]],3:[["Shield HP","+58%"],["Armor Resists","-22%"],["Capacitor recharge time","-27%"],["Targeting Range","+58%"],["Signature Size","+58%"]],4:[["Shield HP","+68%"],["Armor Resists","-27%"],["Capacitor recharge time","-34%"],["Targeting Range","+68%"],["Signature Size","+68%"]],5:[["Shield HP","+85%"],["Armor Resists","-34%"],["Capacitor recharge time","-41%"],
["Targeting Range","+85%"],["Signature Size","+85%"]],6:[["Shield HP","+100%"],["Armor Resists","-50%"],["Capacitor recharge time","-50%"],["Targeting Range","+100%"],["Signature Size","+100%"]]};typeof CCPEVE!="undefined"&&CCPEVE.requestTrust("http://siggy.borkedlabs.com/*");jQuery.extend({scope:function(a,b){return function(){return a.apply(b,arguments)}}});
function siggymain(a){this.systemID=0;this.systemClass=9;this.systemName="";this.systemStats=[];this.lastUpdate=this.freezeSystem=0;this.sigData={};this.editingSig=!1;this.sigClocks={};this.systemList={};this.forceUpdate=!0;this._updateTimeout=null;this.baseUrl="";this.publicMode=!1;this.map=null;this.acsid=0;this.acsname="";this.statsOpened=this.sysInfoCollasped=0;this.idleMax=600;this.idleTimeout=0;this.afked=!1;this._blinkNotesInterval=this.globalNotesEle=null;this.lastGlobalNotesUpdate=0;this.globalNotes=
"";this.editingGlobalNotes=!1;this.defaults={showSigSizeCol:!1,map:{}};this.settings=$.extend(this.defaults,a)}siggymain.prototype.getCurrentTime=function(){var a=new Date;a=pad(a.getUTCHours(),2)+":"+pad(a.getUTCMinutes(),2)+":"+pad(a.getUTCSeconds(),2);delete null;return a};siggymain.displayTimeStamp=function(a){a=new Date(a*1E3);a=pad(a.getUTCDate(),2)+"/"+pad(a.getUTCMonth()+1,2)+" "+pad(a.getUTCHours(),2)+":"+pad(a.getUTCMinutes(),2)+":"+pad(a.getUTCSeconds(),2);delete null;return a};
siggymain.prototype.update=function(){if(this.idleTimeout>=this.idleMax){if(!this.afked)$.blockUI({message:"Please move your mouse to reactivate siggy."}),this.afked=!0;var a=this;$.get(this.baseUrl+"updateSilent",{acsid:this.acsid,acsname:this.acsname},function(b){if(parseInt(b.acsid)!=0)a.acsid=b.acsid;if(b.acsname!="")a.acsname=b.acsname});this._updateTimeout=setTimeout(function(a){a.update(0)},2E4,this)}else{var b={systemID:this.systemID,lastUpdate:this.lastUpdate,lastGlobalNotesUpdate:this.lastGlobalNotesUpdate,
systemName:this.systemName,freezeSystem:this.freezeSystem,acsid:this.acsid,acsname:this.acsname,mapOpen:this.map.isMapOpen(),mapLastUpdate:this.map.lastUpdate};b.forceUpdate=this.forceUpdate;a=this;$.get(this.baseUrl+"update",b,function(b){if(parseInt(b.acsid)!=0)a.acsid=b.acsid;if(b.acsname!="")a.acsname=b.acsname,$("#updateTime span.acsname").text(a.acsname);b.systemUpdate&&(a.updateSystemInfo(b.systemData),a.updateSystemOptionsForm(b.systemData));b.sigUpdate&&a.updateSigs(b.sigData,b.systemUpdate?
!1:!0);if(b.systemListUpdate)a.systemList=b.systemList,a.updateSystemList(a.systemList);if(b.globalNotesUpdate&&!a.editingGlobalNotes){var e=getCookie("notesUpdate")!=null?parseInt(getCookie("notesUpdate")):a.lastGlobalNotesUpdate;!a.globalNotesEle.is(":visible")&&b.lastGlobalNotesUpdate>e&&e!=0&&a.blinkNotes();a.lastGlobalNotesUpdate=b.lastGlobalNotesUpdate;setCookie("notesUpdate",b.lastGlobalNotesUpdate,365);a.globalNotes=b.globalNotes;$("#thegnotes").html(a.globalNotes.replace(/\n/g,"<br />"));
$("#gNotesTime").text(siggymain.displayTimeStamp(a.lastGlobalNotesUpdate))}a.map.isMapOpen()&&(b.mapUpdate&&a.map.update(b.chainMap.lastUpdate,b.chainMap.systems,b.chainMap.wormholes),typeof b.chainMap!="undefined"&&typeof b.chainMap.actives!=""&&a.map.updateActives(b.chainMap.actives));a.lastUpdate=b.lastUpdate},"json");this.forceUpdate=!1;$("#updateTime span.time").text(this.getCurrentTime());this._updateTimeout=setTimeout(function(a){a.update(0)},1E4,this);return!0}};
siggymain.prototype.sortSystemListInUse=function(a,b){return a[1]>b[1]?-1:1};siggymain.prototype.sortSystemListLastActive=function(a,b){return a[2]>b[2]?-1:1};siggymain.prototype.sortSystemList=function(a,b){if(a[1]==b[1])return a[2]>b[2]?-1:1;else if(a[1]>b[1])return-1;else if(a[1]<b[1])return 1};
siggymain.prototype.updateSystemList=function(a){var b=[],c;for(c in a)b.push([c,a[c].inUse,a[c].lastActive]);b.sort(this.sortSystemList);var e=$("#systemList ul");e.empty();for(c in b){var d=b[c][0],f=Number(a[d].sysClass);switch(f){case 1:case 2:case 3:var g="classUnknown";break;case 4:case 5:g="classDangerous";break;case 6:g="classDeadly";break;case 7:g="classHigh";f="H";break;case 8:g="classLow";f="L";break;case 9:g="classNull";f="N";break;default:g="classUnknown"}var h="";h=a[d].displayName!=
""?a[d].displayName:a[d].name;f=$("<li>").text(h).prepend($("<span>").addClass("sysClass").addClass(g).text(f));this.registerSwitchHandler(f,a[d].systemID,a[d].name);a[d].name==this.systemName&&f.addClass("sysSelected");a[d].inUse==1?f.addClass("inUse"):f.addClass("notInUse");e.append(f)}};siggymain.prototype.registerSwitchHandler=function(a,b,c){var e=this;a.click(function(){e.switchSystem(b,c)})};siggymain.prototype.updateNow=function(){clearTimeout(this._updateTimeout);return this.update()};
siggymain.prototype.switchSystem=function(a,b){this.setSystemID(a);this.systemName=b;this.forceUpdate=!0;this.freeze();clearTimeout(this._updateTimeout);$("#sigTable tbody").empty();this.editingSig=!1;this.sigData={};$("#sigAddBox select[name=type]").val(0);this.updateSiteSelect("#sigAddBox select[name=site]",this.systemClass,0,0);this.updateNow()&&$(document).trigger("siggy.switchSystem",a)};
siggymain.prototype.updateSigs=function(a,b){for(var c in this.sigData)typeof a[c]!==void 0&&typeof a[c]!="undefined"&&a[c]!==null?(a[c].exists=!0,this.sigData[c].editing||(this.sigData[c]=a[c],this.updateSigRow(this.sigData[c],b))):this.sigData[c].editing||(this.removeSigRow(this.sigData[c]),delete this.sigData[c],delete this.sigClocks[c]);for(c in a)a[c].exists!=!0&&(this.addSigRow(a[c],b),this.sigData[c]=a[c]);$("#sigTable").trigger("update")};
siggymain.prototype.updateSystemInfo=function(a){$("#region").text(a.regionName);$("#constellation").text(a.constellationName);$("#planetsmoons").text(a.planets+"/"+a.moons);$("#truesec").text(a.truesec.substr(0,8));$("#radius").text(a.radius+" AU");$("#belts").text(a.belts);var b=$("#collaspedInfoEffectStatic");b.empty();$("#systemInfo-collasped p.spacer").hide();$("#systemEffect").empty();var c=$("<p>").text(a.effectTitle),e=$("#systemEffect").append(c),d="",f=$("<span>").text(a.effectTitle=="None"?
"":a.effectTitle);if(a.effectTitle!="None"){d+="<b>Class "+a.sysClass+" Effects</b><br /><br />";if(a.effectTitle=="Black Hole")var g=blackHoleEffects[a.sysClass];else a.effectTitle=="Wolf-Rayet Star"?g=wolfRayetEffects[a.sysClass]:a.effectTitle=="Red Giant"?g=redGiantEffects[a.sysClass]:a.effectTitle=="Cataclysmic Variable"?g=catacylsmicEffects[a.sysClass]:a.effectTitle=="Magnetar"?g=magnetarEffects[a.sysClass]:a.effectTitle=="Pulsar"&&(g=pulsarEffects[a.sysClass]);for(var h=0;h<g.length;h++)d+=
"<b>"+g[h][0]+":&nbsp;</b>"+g[h][1]+"<br />";e.append($("<div>").attr("id","systemEffects").addClass("tooltip").html(d));b.append($("<div>").attr("id","systemEffectsCollasped").addClass("tooltip").html(d));c.ezpz_tooltip({contentId:"systemEffects"});f.ezpz_tooltip({contentId:"systemEffectsCollasped"});$("#systemInfo-collasped p.spacer").show();b.append(f);b.append(" - ")}$("#staticInfo").empty();c=Object.size(a.staticData);if(c>0){b.append("[");e=0;for(h in a.staticData)d=a.staticData[h],g="",d.staticDestClass=
Number(d.staticDestClass),g=d.staticDestClass<=6?" (to C"+d.staticDestClass+")":d.staticDestClass==7?" (to Highsec)":d.staticDestClass==8?" (to Lowsec)":" (to Nullsec)",f=$("<p>").text(d.staticName+g),g="<b>"+d.staticName+g+"</b><br />Max Mass: "+d.staticMass+" billion<br />Max Jumpable Mass: "+d.staticJumpMass+" million<br />Max Lifetime: "+d.staticLifetime+" hrs<br />Signature Size: "+d.staticSigSize+" <br />",$("#staticInfo").append(f).append($("<div>").attr("id","static-info-"+d.staticID).addClass("tooltip").html(g)),
f.ezpz_tooltip({contentId:"static-info-"+d.staticID}),f=c>1&&e+1!=c?$("<span>").text(d.staticName+" "):$("<span>").text(d.staticName),b.append(f).append($("<div>").attr("id","static-info-collasped-"+d.staticID).addClass("tooltip").html(g)),f.ezpz_tooltip({contentId:"static-info-collasped-"+d.staticID}),e++;$("#systemInfo-collasped p.spacer").show();b.append("]")}b=a.name;a.displayName!=""&&(b+=" ("+a.displayName+")");a.sysClass=parseInt(a.sysClass);b+=a.sysClass<=6?" - [C"+a.sysClass+"]":a.sysClass<=
8?" - ["+a.sec+"]":" - [0.0]";$(".systemName").text(b);$("a.dotlan").attr("href","http://evemaps.dotlan.net/system/"+a.name);$("a.evekill").attr("href","http://eve.battleclinic.com/killboard/recent_activity.php?searchTerms="+a.name);this.setSystemID(a.id);this.setSystemClass(a.sysClass);this.systemName=a.name;a.stats.length>0?(this.systemStats=a.stats,this.statsOpened&&this.renderStats()):this.systemStats=[]};
siggymain.prototype.renderStats=function(){for(var a={lines:{show:!0},points:{show:!1},xaxis:{mode:"time",minTickSize:[1,"hour"],ticks:13,labelAngle:45,color:"#fff"},yaxis:{color:"#fff",tickDecimals:0}},b=[],c=[],e=[],d=[],f=0;f<this.systemStats.length;f++)b.push([parseInt(this.systemStats[f][0]),parseInt(this.systemStats[f][1])]),c.push([parseInt(this.systemStats[f][0]),parseInt(this.systemStats[f][4])]),e.push([parseInt(this.systemStats[f][0]),parseInt(this.systemStats[f][2])]),d.push([parseInt(this.systemStats[f][0]),
parseInt(this.systemStats[f][3])]);$.plot($("#jumps"),[{data:b,lines:{show:!0,fill:!0}},{data:c,lines:{show:!0,fill:!0}}],a);$.plot($("#shipKills"),[{data:e,lines:{show:!0,fill:!0}}],a);$.plot($("#npcKills"),[{data:d,lines:{show:!0,fill:!0}}],a)};siggymain.prototype.setBearTab=function(a){$("#bearClassLinks a").each(function(){$(this).text()=="C"+a?$(this).addClass("active"):$(this).removeClass("active")});$("#bearInfoSets div").each(function(){$(this).attr("id")=="bearClass"+a?$(this).show():$(this).hide()})};
siggymain.prototype.updateSystemOptionsForm=function(a){$("#systemOptions table th").text("System Options for "+a.name);$("#systemOptions input[name=label]").val(a.displayName);$("#systemOptions input[name=inUse]").filter("[value="+a.inUse+"]").attr("checked",!0);$("#systemOptions select[name=activity]").val(a.activity)};
siggymain.prototype.updateSigRow=function(a){var b="<b>Added by:</b> "+a.creator;a.lastUpdater!=""&&typeof a.lastUpdater!="undefined"&&(b+="<br /><b>Updated by:</b> "+a.lastUpdater,b+="<br /><b>Updated at:</b> "+siggymain.displayTimeStamp(a.updated));$("#sig-"+a.sigID+" td.sig").text(a.sig);$("#sig-"+a.sigID+" td.type").text(this.convertType(a.type));this.settings.showSigSizeCol&&$("#sig-"+a.sigID+" td.size").text(a.sigSize);$("#sig-"+a.sigID+" td.desc").text(this.convertSiteID(this.systemClass,a.type,
a.siteID));$("#sig-"+a.sigID+" td.desc p").remove();$("#sig-"+a.sigID+" td.desc").append($("<p>").text(a.description));$("creation-info-"+a.sigID).html(b)};siggymain.prototype.removeSigRow=function(a){$("#sig-"+a.sigID).remove();this.colorizeSigRows()};
siggymain.prototype.addSigRow=function(a,b){var c=this,e=$("<td>").addClass("desc");e.text(this.convertSiteID(this.systemClass,a.type,a.siteID));e.append($("<p>").text(a.description));var d="<b>Added by:</b> "+a.creator;a.lastUpdater!=""&&typeof a.lastUpdater!="undefined"&&(d+="<br /><b>Updated by:</b> "+a.lastUpdater,d+="<br /><b>Updated at:</b> "+siggymain.displayTimeStamp(a.updated));var f=$("<tr>").attr("id","sig-"+a.sigID).append($("<td>").addClass("center").addClass("edit").append($("<img>").attr("src",
this.baseUrl+"public/images/pencil.png").click(function(){c.editSigForm(a.sigID)}))).append($("<td>").addClass("center").addClass("sig").text(a.sig));this.settings.showSigSizeCol&&f.append($("<td>").addClass("center").addClass("size").text(a.sigSize));f.append($("<td>").addClass("center").addClass("type").text(this.convertType(a.type))).append(e).append($("<td>").addClass("center").addClass("moreinfo").append($("<img>").attr("src",this.baseUrl+"public/images/information.png")).append($("<div>").addClass("tooltip").attr("id",
"creation-info-"+a.sigID).html(d))).append($("<td>").addClass("center").addClass("age").append($("<span>").text("--")).append($("<div>").addClass("tooltip").attr("id","age-timestamp-"+a.sigID).text(siggymain.displayTimeStamp(a.created)))).append($("<td>").addClass("center").addClass("remove").append($("<img>").attr("src",this.baseUrl+"public/images/delete.png")).click(function(){c.removeSig(a.sigID)}));$("#sigTable tbody").append(f);this.sigClocks[a.sigID]=new CountUp(a.created*1E3,"#sig-"+a.sigID+
" td.age span","test");$("#sig-"+a.sigID+" td.moreinfo img").ezpz_tooltip({contentId:"creation-info-"+a.sigID});$("#sig-"+a.sigID+" td.age span").ezpz_tooltip({contentId:"age-timestamp-"+a.sigID});this.colorizeSigRows();b&&$("#sig-"+a.sigID).fadeOutFlash("#A46D00",2E4)};
siggymain.prototype.editSigForm=function(a){if(!this.editingSig){this.editingSig=this.sigData[a].editing=!0;var b=$("#sig-"+a+" td.edit");b.text("");var c=this;b.append($("<img>").attr("src",this.baseUrl+"public/images/accept.png").click(function(){c.editSig(a)}));var e=$("#sig-"+a+" td.sig");e.text("");b=$("<input>").val(this.sigData[a].sig).addClass("sigEdit").attr("maxlength",3).keypress(function(b){b.which==13&&c.editSig(a)});e.append(b);this.settings.showSigSizeCol&&(e=$("#sig-"+a+" td.size"),
e.text(""),e.append(this.generateOrderedSelect([["","--"],["1","1"],["2.2","2.2"],["2.5","2.5"],["4","4"],["5","5"],["6.67","6.67"],["10","10"]],this.sigData[a].sigSize)));e=$("#sig-"+a+" td.type");e.text("");e.append(this.generateSelect({none:"--",wh:"WH",ladar:"Ladar",radar:"Radar",mag:"Mag",grav:"Grav"},this.sigData[a].type).change(function(){c.editTypeSelectChange(a)}));e=$("#sig-"+a+" td.desc");e.text("");e.append(this.generateSiteSelect(this.systemClass,this.sigData[a].type,this.sigData[a].siteID)).append($("<br />")).append($("<input>").val(this.sigData[a].description).keypress(function(b){b.which==
13&&c.editSig(a)}).css("width","100%"));b.focus()}};siggymain.prototype.editTypeSelectChange=function(a){var b=$("#sig-"+a+" td.type select").val();this.sigData[a].type!=b&&this.updateSiteSelect("#sig-"+a+" td.desc select",this.systemClass,b,0)};
siggymain.prototype.editSig=function(a){var b=$("#sig-"+a+" td.sig input");if(this.settings.showSigSizeCol){var c=$("#sig-"+a+" td.size select");console.log(c)}var e=$("#sig-"+a+" td.type select"),d=$("#sig-"+a+" td.desc input"),f=$("#sig-"+a+" td.desc select");if(b.val().length!=3)return!1;this.sigData[a].sig=b.val().toUpperCase();this.sigData[a].type=e.val();this.sigData[a].siteID=f.val();this.sigData[a].description=d.val();var g={sigID:a,sig:this.sigData[a].sig,type:this.sigData[a].type,desc:this.sigData[a].description,
siteID:this.sigData[a].siteID,systemID:this.systemID};if(this.settings.showSigSizeCol)this.sigData[a].sigSize=c.val(),g.sigSize=this.sigData[a].sigSize;var h=this;$.post(this.baseUrl+"dosigEdit",g,function(){h.editingSig=!1;h.sigData[a].editing=!1});b.remove();this.settings.showSigSizeCol&&c.remove();e.remove();d.remove();f.remove();this.updateSigRow(this.sigData[a]);b=$("#sig-"+a+" td.edit");b.text("");b.append($("<img>").attr("src",this.baseUrl+"public/images/pencil.png").click(function(){h.editSigForm(a)}))};
siggymain.prototype.updateSiteSelect=function(a,b,c,e){a=$(a);a.empty();var d=[];switch(c){case "wh":d=whLookup[b];break;case "ladar":d=ladarsLookup;break;case "mag":d=magsLookup[b];break;case "grav":d=gravsLookup;break;case "radar":d=radarsLookup[b];break;default:d={0:"--"}}for(var f in d)a.append($("<option>").attr("value",f).text(d[f]));a.val(e)};
siggymain.prototype.generateSiteSelect=function(a,b,c){return b=="wh"?this.generateSelect(whLookup[a],c):b=="ladar"?this.generateSelect(ladarsLookup,c):b=="mag"?this.generateSelect(magsLookup[a],c):b=="grav"?this.generateSelect(gravsLookup,c):b=="radar"?this.generateSelect(radarsLookup[a],c):this.generateSelect({0:"--"},0)};siggymain.prototype.generateOrderedSelect=function(a,b){for(var c=$("<select>"),e=0;e<a.length;e++)c.append($("<option>").attr("value",a[e][0]).text(a[e][1]));c.val(b);return c};
siggymain.prototype.generateSelect=function(a,b){var c=$("<select>"),e;for(e in a)c.append($("<option>").attr("value",e).text(a[e]));c.val(b);return c};siggymain.prototype.removeSig=function(a){delete this.sigClocks[a];this.removeSigRow({sigID:a});$("#sigTable").trigger("update");$.post(this.baseUrl+"dosigRemove",{systemID:this.systemID,sigID:a})};siggymain.prototype.convertType=function(a){return a=="none"||a==null||a=="null"?"":a=="wh"?"WH":a.charAt(0).toUpperCase()+a.slice(1)};
siggymain.prototype.convertSiteID=function(a,b,c){return b=="wh"?whLookup[a][c]:b=="mag"?magsLookup[a][c]:b=="radar"?radarsLookup[a][c]:b=="ladar"?ladarsLookup[c]:b=="grav"?gravsLookup[c]:""};siggymain.prototype.setSystemID=function(a){this.systemID=a};siggymain.prototype.setSystemClass=function(a){this.systemClass=a;a<=6?this.setBearTab(a):this.setBearTab(1)};
siggymain.prototype.colorizeSigRows=function(){var a=0;$("#sigTable tbody tr").each(function(){$(this).removeClass("alt");a%2!=0&&$(this).addClass("alt");a++})};
siggymain.prototype.setupAddBox=function(){$("#sigAddBox select[name=type]").val("none");var a=this;$("#sigAddBox form").submit(function(){var b=$("#sigAddBox input[name=sig]"),c=$("#sigAddBox select[name=type]"),e=$("#sigAddBox input[name=desc]"),d=$("#sigAddBox select[name=site]");if(b.val().length!=3)return!1;var f=c.val()==null?"none":c.val();postData={systemID:a.systemID,sig:b.val(),type:f,desc:e.val(),siteID:d.val()};if(a.settings.showSigSizeCol){var g=$("#sigAddBox select[name=size]");postData.sigSize=
g.val()}$.post(a.baseUrl+"dosigAdd",postData,function(b){for(var c in b)a.addSigRow(b[c]);$.extend(a.sigData,b);$("#sigTable").trigger("update")},"json");b.val("");a.settings.showSigSizeCol&&g.val("");c.val("none");e.val("");d.replaceWith($("<select>").attr("name","site"));b.focus();return!1});$("#sigAddBox select[name=type]").change(function(){newType=$(this).val();a.updateSiteSelect("#sigAddBox select[name=site]",a.systemClass,newType,0)}).keypress(this.addBoxEnterHandler);this.settings.showSigSizeCol&&
$("#sigAddBox select[name=size]").keypress(this.addBoxEnterHandler);$(document).on("keypress","#sigAddBox select[name=site]",this.addBoxEnterHandler)};siggymain.prototype.addBoxEnterHandler=function(a){a.which==13&&$("input[name=add]").focus().click()};
siggymain.prototype.initialize=function(){if(getCookie("sysInfoCollasped")!=null)this.sysInfoCollasped=parseInt(getCookie("sysInfoCollasped"));if(getCookie("statsOpened")!=null)this.statsOpened=parseInt(getCookie("statsOpened"));this.map=new siggyMap(this.settings.map);this.map.baseUrl=this.baseUrl;this.map.siggymain=this;this.map.initialize();this.forceUpdate=!0;this.update();$(document).trigger("siggy.switchSystem",this.systemID);var a=this.settings.showSigSizeCol?{0:{sorter:!1},5:{sorter:!1},7:{sorter:!1}}:
{0:{sorter:!1},4:{sorter:!1},6:{sorter:!1}};$("#sigTable").tablesorter({headers:a});var b=this;$("#sigTable").bind("sortEnd",function(){b.colorizeSigRows()});this.setupAddBox();$("#unfreezeLink").click(function(){b.unfreeze()});$("#freezeLink").click(function(){b.freeze()});$("#systemInfoButton").click(function(){b.handleSystemAdvancedMenuClick("info")});$("#systemOptionsButton").click(function(){b.handleSystemAdvancedMenuClick("options")});$("#systemOptions button.save").click(function(){var a=$("#systemOptions input[name=label]").val(),
e=$("#systemOptions input[name=inUse]:checked").val(),d=$("#systemOptions select[name=activity]").val();$.post(b.baseUrl+"dosaveSystemOptions",{systemID:b.systemID,label:a,inUse:e,activity:d},function(){if(b.systemList[b.systemID])b.systemList[b.systemID].displayName=a,b.systemList[b.systemID].inUse=e,b.systemList[b.systemID].activity=d,b.updateSystemList(b.systemList)})});$("#systemOptions button.reset").click(function(){$("#systemOptions input[name=label]").val("");$("#systemOptions input[name=inUse]").filter("[value=0]").attr("checked",
!0);$("#systemOptions select[name=activity]").val(0);$.post(b.baseUrl+"dosaveSystemOptions",{systemID:b.systemID,label:"",inUse:0,activity:0},function(){if(b.systemList[b.systemID])b.systemList[b.systemID].displayName="",b.systemList[b.systemID].inUse=0,b.systemList[b.systemID].activity=0,b.updateSystemList(b.systemList)})});this.initializeGNotes();$("#bearC1").click(function(){b.setBearTab(1);return!1});$("#bearC2").click(function(){b.setBearTab(2);return!1});$("#bearC3").click(function(){b.setBearTab(3);
return!1});$("#bearC4").click(function(){b.setBearTab(4);return!1});$("#bearC5").click(function(){b.setBearTab(5);return!1});$("#bearC6").click(function(){b.setBearTab(6);return!1});$(".carebear").click(function(){$.blockUI({message:$("#carebearBox"),css:{border:"none",padding:"15px",background:"transparent",color:"inherit",cursor:"auto",textAlign:"left",top:"20%",width:"auto",centerX:!0,centerY:!1},overlayCSS:{cursor:"auto"},fadeIn:0,fadeOut:0});$(".blockOverlay").attr("title","Click to unblock").click($.unblockUI)});
accessMenu=new siggyMenu({ele:"accessMenu",dir:"down",callback:function(a){window.location.replace(b.baseUrl+"doswitchMembership/?k="+a)},callbackMode:"wildcard"});accessMenu.initialize();$(window).mousemove(function(){b.idleTimeout=0;if(b.afked)b.afked=!1,$.unblockUI(),b.updateNow()});setInterval(function(){b.idleTimeout>=b.idleMax||b.afked||(b.idleTimeout+=1)},1E3);this.initializeSystemExpandCollaspe()};
siggymain.prototype.initializeSystemExpandCollaspe=function(){var a=this;$("#systemInfo-collaspe").click(function(){$("#systemInfo-collasped").show();$("#systemInfo").hide();a.sysInfoCollasped=1;setCookie("sysInfoCollasped",1,365)});$("#systemInfo-expand").click(function(){$("#systemInfo-collasped").hide();$("#systemInfo").show();a.sysInfoCollasped=0;setCookie("sysInfoCollasped",0,365)});$("#stats h3").click(function(){var b=$("#stats > div");b.is(":visible")?(b.hide(),a.statsOpened=0,setCookie("statsOpened",
0,365)):(b.show(),a.renderStats(),a.statsOpened=1,setCookie("statsOpened",1,365))})};
siggymain.prototype.initializeGNotes=function(){var a=this;this.globalNotesEle=$("#globalNotes");$("#globalNotesButton").click(function(){a.globalNotesEle.is(":visible")?(a.globalNotesEle.hide(),$("#globalNotesButton").html("Show Notes &darr;")):(a.globalNotesEle.show(),$("#globalNotesButton").html("Hide Notes &uarr;"),a.stopBlinkingNotes())});$("#gNotesEdit").click(function(){$(this).hide();$("#thegnotes").hide();$("#gNotesEditBox").val(a.globalNotes).show();$("#gNotesSave").show();$("#gNotesCancel").show()});
$("#gNotesSave").click(function(){a.globalNotes=$("#gNotesEditBox").val();$.post(a.baseUrl+"doglobalNotesSave",{notes:a.globalNotes},function(b){a.editingGlobalNotes=!1;a.lastGlobalNotesUpdate=b;setCookie("notesUpdate",a.lastGlobalNotesUpdate,365);$("#gNotesTime").text(siggymain.displayTimeStamp(a.lastGlobalNotesUpdate))});$("#thegnotes").html(a.globalNotes.replace(/\n/g,"<br />")).show();$("#gNotesEditBox").hide();$("#gNotesEdit").show();$("#gNotesCancel").hide();$(this).hide()});$("#gNotesCancel").click(function(){this.editingGlobalNotes=
!1;$("#thegnotes").show();$("#gNotesEditBox").hide();$("#gNotesEdit").show();$("#gateNotesSave").hide();$(this).hide()})};siggymain.prototype.blinkNotes=function(){if(this._blinkNotesInterval==null)$("#globalNotesButton").flash("#A46D00",3E3),this._blinkNotesInterval=setInterval(function(){$("#globalNotesButton").flash("#A46D00",3E3)},4E3)};siggymain.prototype.stopBlinkingNotes=function(){if(this._blinkNotesInterval!=null)clearInterval(this._blinkNotesInterval),this._blinkNotesInterval=null};
siggymain.prototype.handleSystemAdvancedMenuClick=function(a){var b=$("#systemInfoButton"),c=$("#systemOptionsButton");a=="options"?(b.removeClass("selected"),c.addClass("selected"),$("#systemInfo").hide(),$("#systemOptions").show()):(c.removeClass("selected"),b.addClass("selected"),this.sysInfoCollasped==0&&$("#systemInfo").show(),$("#systemOptions").hide())};siggymain.prototype.freeze=function(){this.freezeSystem=1;$("#freezeOpt").hide();$("#unfreezeOpt").show()};
siggymain.prototype.unfreeze=function(){this.freezeSystem=0;$("#unfreezeOpt").hide();$("#freezeOpt").show()};function siggyMenu(a){this.settings=$.extend({},{ele:"",dir:"up",callbackMode:"specific",optionCallbacks:null,callback:null},a);this.eleobj=$("#"+this.settings.ele);this.titletext=this.eleobj.find("span");this.menu=this.eleobj.find("ul.menu");this.menuItems=this.menu.find("li")}
siggyMenu.prototype.initialize=function(){this.eleobj.data("opened",!1);this.eleobj.data("disabled",!1);var a=this;this.eleobj.click(function(b){if($(this).data("opened")||$(this).data("disabled"))return!1;$(this).addClass("opened");a.menu.show();var e=a.settings.dir=="up"?-1*a.menu.height()-1:a.eleobj.height()+1;a.menu.css("top",e+"px");$("body").one("click",function(){a.menu.hide();a.menu.parent().removeClass("opened");a.menu.parent().opened=!1});$(this).opened=!0;b.stopPropagation()});if(this.settings.callbackMode==
"specific")for(var b in this.settings.optionCallbacks)typeof this.settings.optionCallbacks[b]=="function"&&$("#"+b).click(function(b){a.menu.hide();a.eleobj.opened=!1;a.eleobj.removeClass("opened");a.settings.optionCallbacks[$(this).attr("id")].call(this);b.stopPropagation()});else this.menuItems.click(function(b){a.menu.hide();a.eleobj.opened=!1;a.eleobj.removeClass("opened");a.settings.callback.call(this,$(this).attr("id"));b.stopPropagation()})};function siggyCalc(){this.currentProfile={covertOps:0,rangeFinding:0,rigs:0,prospector:0,sistersLauncher:0,sistersProbes:0};this.currentProfileID=0;this.baseSigSizes=[1.25,1.67,2.2,2.5,4,5,6.67,10,20];this.mode=this.baseUrl="";this.profiles={};this.loaded=!1}
siggyCalc.prototype.loadData=function(){var a=$("#scanProfiles"),b=this;$.ajax({url:this.baseUrl+"doLoadScanProfiles",async:!1,dataType:"json",success:function(c){var e=0;a.empty();b.profiles=c;for(var d in c)if(e++,a.append($("<option>").attr("value",c[d].profileID).text(c[d].profileName)),c[d].profileID=parseInt(c[d].profileID),c[d].covertOps=parseInt(c[d].covertOps),c[d].rangeFinding=parseInt(c[d].rangeFinding),c[d].rigs=parseInt(c[d].rigs),c[d].prospector=parseInt(c[d].prospector),c[d].sistersLauncher=
parseInt(c[d].sistersLauncher),c[d].sistersProbes=parseInt(c[d].sistersProbes),c[d].preferred=parseInt(c[d].preferred),c[d].preferred==1)b.currentProfile=c[d],b.currentProfileID=d,a.val(d);$("#createProfile").attr("disabled",!1);if(e>0){$("#editProfile").attr("disabled",!1);$("#deleteProfile").attr("disabled",!1);if(b.currentProfileID==0){e=0;for(e in c)break;b.currentProfile=c[e];b.currentProfileID=e;a.val(d)}b.fillProfileInfo(b.currentProfile);b.calcAndPopulate();$("#strengthTable").show();$("#profileInfo").show()}else $("#editProfile").attr("disabled",
!0),$("#deleteProfile").attr("disabled",!0);b.loaded=!0}})};
siggyCalc.prototype.initialize=function(){var a=$("#scanProfiles"),b=this;$("#editProfile").click(function(){$("#createProfile").attr("disabled",!0);$("#editProfile").attr("disabled",!0);$("#deleteProfile").attr("disabled",!0);$("#scanProfiles").attr("disabled",!0);$("#inputProfileName").val(b.currentProfile.profileName);$("#selectCovertOps").val(b.currentProfile.covertOps);$("#selectRigs").val(b.currentProfile.rigs);$("#selectRangeFinding").val(b.currentProfile.rangeFinding);$("#selectProspector").val(b.currentProfile.prospector);
$("input[name=sistersLauncher]").filter("[value="+b.currentProfile.sistersLauncher+"]").attr("checked",!0);$("input[name=sistersProbes]").filter("[value="+b.currentProfile.sistersProbes+"]").attr("checked",!0);$("input[name=preferred]").filter("[value="+b.currentProfile.preferred+"]").attr("checked",!0);b.mode="edit";$("#strengthTable").hide();$("#profileInfo").hide();$("#scanProfileOptions").show()});$("#createProfile").click(function(){$("#createProfile").attr("disabled",!0);$("#editProfile").attr("disabled",
!0);$("#deleteProfile").attr("disabled",!0);$("#scanProfiles").attr("disabled",!0);$("#inputProfileName").val("");$("#selectCovertOps").val(0);$("#selectRigs").val(0);$("#selectRangeFinding").val(0);$("#selectProspector").val(0);$("input[name=sistersLauncher]").filter('[value="0"]').attr("checked",!0);$("input[name=sistersProbes]").filter('[value="0"]').attr("checked",!0);$("input[name=preferred]").filter('[value="1"]').attr("checked",!0);b.mode="create";$("#strengthTable").hide();$("#profileInfo").hide();
$("#scanProfileOptions").show()});$("#deleteProfile").click(function(){$.post(b.baseUrl+"dodeleteScanProfile",{profileID:b.currentProfileID});$("#scanProfiles option[value="+b.currentProfileID+"]").remove();delete b.profiles[b.currentProfileID];delete b.currentProfile;var c=0;for(c in b.profiles);c!=0?(b.currentProfileID=c,b.currentProfile=b.profiles[b.currentProfileID],a.val(b.currentProfileID),b.fillProfileInfo(b.currentProfile),b.calcAndPopulate()):($("#editProfile").attr("disabled",!0),$("#deleteProfile").attr("disabled",
!0),$("#profileInfo").hide(),$("#strengthTable").hide())});$("#saveScanProfile").click(function(){data={};data.profileName=$("#inputProfileName").val();if(data.profileName=="")return!1;data.covertOps=$("#selectCovertOps").val();data.rigs=$("#selectRigs").val();data.rangeFinding=$("#selectRangeFinding").val();data.prospector=$("#selectProspector").val();data.sistersLauncher=$("input[name=sistersLauncher]:checked").val();data.sistersProbes=$("input[name=sistersProbes]:checked").val();data.preferred=
$("input[name=preferred]:checked").val();data.mode=b.mode;if(b.mode=="edit")data.profileID=b.currentProfileID;$.post(b.baseUrl+"doTweakScanProfile",data,function(c){c.profileID=parseInt(c.profileID);c.covertOps=parseInt(c.covertOps);c.rangeFinding=parseInt(c.rangeFinding);c.rigs=parseInt(c.rigs);c.prospector=parseInt(c.prospector);c.sistersLauncher=parseInt(c.sistersLauncher);c.sistersProbes=parseInt(c.sistersProbes);c.preferred=parseInt(c.preferred);b.profiles[c.profileID]=c;b.currentProfile=b.profiles[c.profileID];
b.currentProfileID=b.profiles[c.profileID];b.mode=="create"&&(a.append($("<option>").attr("value",c.profileID).text(c.profileName)),a.val(c.profileID));if(c.preferred)for(var e in b.profiles)if(e!=c.profileID)b.profiles[e].preferred=0;b.fillProfileInfo(b.currentProfile);$("#profileInfo").show();$("#strengthTable").show();$("#scanProfileOptions").hide();b.calcAndPopulate();b.mode="";$("#createProfile").attr("disabled",!1);$("#editProfile").attr("disabled",!1);$("#deleteProfile").attr("disabled",!1);
$("#scanProfiles").attr("disabled",!1)},"json")});$("#cancelProfile").click(function(){$("#createProfile").attr("disabled",!1);Object.size(b.profiles)>0&&($("#editProfile").attr("disabled",!1),$("#deleteProfile").attr("disabled",!1));$("#scanProfiles").attr("disabled",!1);b.mode="";$("#scanProfileOptions").hide();b.currentProfileID!=0&&($("#profileInfo").show(),$("#strengthTable").show(),b.calcAndPopulate())});a.change(function(){var a=$(this).val();if(a!=b.currentProfileID&&a!=0)b.currentProfile=
b.profiles[a],b.currentProfileID=a,b.fillProfileInfo(b.currentProfile),b.calcAndPopulate()});$("#strengthCalcButton").click(function(){$("#sigCalculator").is(":visible")?($("#sigCalculator").hide(),$(this).html("Strength Calc. &darr;")):(b.loaded||b.loadData(),$("#sigCalculator").show(),$(this).html("Strength Calc. &uarr;"))})};
siggyCalc.prototype.fillProfileInfo=function(a){$("#infoCovertOps").text(this.fancyLevelString(a.covertOps));$("#infoRangeFinding").text(this.fancyLevelString(a.rangeFinding));$("#infoRigs").text(this.fancyRigs(a.rigs));$("#infoSistersLauncher").text(this.intToYesNo(a.sistersLauncher));$("#infoSistersProbes").text(this.intToYesNo(a.sistersProbes));$("#infoProspector").text(this.fancyProspector(a.prospector))};
siggyCalc.prototype.fancyLevelString=function(a){switch(a){case 1:return"Level I";case 2:return"Level II";case 3:return"Level III";case 4:return"Level IV";case 5:return"Level V";default:return""}};siggyCalc.prototype.intToYesNo=function(a){return a==1?"Yes":"No"};siggyCalc.prototype.fancyProspector=function(a){switch(a){case 1:return"PPH-0";case 2:return"PPH-1";case 3:return"PPH-2";default:return"None"}};
siggyCalc.prototype.fancyRigs=function(a){switch(a){case 1:return"T1 - 1 rig";case 2:return"T1 - 2 rigs";case 3:return"T2 - 1 rig";case 4:return"T2 - 2 rig";case 5:return"T1 & T2 - mixed";default:return"None"}};
siggyCalc.prototype.calcAndPopulate=function(){var a=this.currentProfile.covertOps*0.1,b=this.currentProfile.rangeFinding*0.1,c=0;switch(this.currentProfile.rigs){case 1:c=0.1;break;case 2:c=0.2;break;case 3:c=0.15;break;case 4:c=0.3;break;case 5:c=0.25;break;default:c=0}var e=0;switch(this.currentProfile.prospector){case 1:e=0.02;break;case 2:e=0.06;break;case 3:e=0.1;break;default:e=0}var d=this.currentProfile.sistersLauncher==1?0.05:0,f=(1+a)*(1+b)*(1+c)*(1+e)*(1+d)*(1+(this.currentProfile.sistersProbes==
1?0.1:0));a=(1+a)*(1+b)*(1+c)*(1+e)*(1+d);for(var g in this.baseSigSizes)c=this.baseSigSizes[g]*2.57/12800,b=String(this.baseSigSizes[g]).replace(".",""),e=roundNumber(c*f*400,2),$("#core-"+b).text(e+"%"),e=roundNumber(c*f*200,2),$("#combat-"+b).text(e+"%"),c=roundNumber(c*a*100,2),$("#deep-"+b).text(c+"%")};Raphael.fn.fixNS=function(){var a=this,b;for(b in Raphael.fn){var c=Raphael.fn[b];if(typeof c=="object")for(var e in c){var d=c[e];c[e]=function(){return d.apply(a,arguments)}}}};
Raphael.fn.connection=function(a,b,c,e){if(a.line&&a.from&&a.to)c=a,a=c.from,b=c.to;for(var d=a.getBBox(),f=b.getBBox(),g=[{x:d.x+d.width/2,y:d.y-1},{x:d.x+d.width/2,y:d.y+d.height+1},{x:d.x-1,y:d.y+d.height/2},{x:d.x+d.width+1,y:d.y+d.height/2},{x:f.x+f.width/2,y:f.y-1},{x:f.x+f.width/2,y:f.y+f.height+1},{x:f.x-1,y:f.y+f.height/2},{x:f.x+f.width+1,y:f.y+f.height/2}],h={},k=[],j=0;j<4;j++)for(var i=4;i<8;i++)if(f=Math.abs(g[j].x-g[i].x),d=Math.abs(g[j].y-g[i].y),j==i-4||(j!=3&&i!=6||g[j].x<g[i].x)&&
(j!=2&&i!=7||g[j].x>g[i].x)&&(j!=0&&i!=5||g[j].y>g[i].y)&&(j!=1&&i!=4||g[j].y<g[i].y))k.push(f+d),h[k[k.length-1]]=[j,i];i=k.length==0?[0,4]:h[Math.min.apply(Math,k)];h=g[i[0]].x;k=g[i[0]].y;j=g[i[1]].x;g=g[i[1]].y;f=Math.max(Math.abs(h-j)/2,10);d=Math.max(Math.abs(k-g)/2,10);var l=[h,h,h-f,h+f][i[0]].toFixed(3),m=[k-d,k+d,k,k][i[0]].toFixed(3);f=[0,0,0,0,j,j,j-f,j+f][i[1]].toFixed(3);d=[0,0,0,0,k+d,k-d,g,g][i[1]].toFixed(3);d=["M",h.toFixed(3),k.toFixed(3),"C",l,m,f,d,j.toFixed(3),g.toFixed(3)].join(",");
if(c&&c.line)c.bg&&c.bg.attr({path:d}),c.line.attr({path:d});else return c=typeof c=="string"?c:"#000",{bg:e&&e.split&&this.path(d).attr({stroke:e.split("|")[0],fill:"none","stroke-width":e.split("|")[1]||3}),line:this.path(d).attr({stroke:c,fill:"none","stroke-width":8}),from:a,to:b}};
Raphael.el.tooltip=function(a){this.tp=a;this.tp.ox=0;this.tp.oy=0;this.tp.disabled=!1;this.tp.hide();this.hover(function(){this.tp.disabled!=!0&&(this.mousemove(function(a){var c=$(a.target.ownerSVGElement).offset();this.tp.translate(a.pageX-c.left-this.tp.ox,a.pageY-c.top-this.tp.oy);this.tp.ox=a.pageX-c.left;this.tp.oy=a.pageY-c.top}),this.tp.show().toFront())},function(){this.tp.hide();this.unmousemove()});return this};
function siggyMap(a){this.defaults={jumpLog:!0,jumpLogCharNames:!0,jumpLogTimes:!0};this.settings=$.extend(this.defaults,a);this.systems={};this.wormholes={};this.drawnSystems={};this.drawnConnections=[];this.baseUrl="";this.buttonsContainer=this.deletingMessage=this.editingMessage=this.loadingMessage=this.siggymain=this.r=this.svg=this.ctx=this.canvas=this.container=null;this.updated=!1;this.originY=this.originX=0;this.editorOpen=this.massDelete=this.editing=!1;this.editorMode="";this.lastUpdate=
this.editingHash=0;this.mapOpen=getCookie("mapOpen")!=null?parseInt(getCookie("mapOpen")):0;this.broadcast=getCookie("broadcast")!=null?parseInt(getCookie("broadcast")):1;this.maxBarX=this.maxX=0;this.panXactive=!1;this.panX=0;this.massSelect=!1;this.selectedSystemRect=this.massSelectBox=null;this.selectedSystemID=0;this.infoicon=null}
siggyMap.prototype.showMessage=function(a){a=="loading"?(this.loadingMessage.css({top:this.container.height()/2-this.loadingMessage.height()/2,left:this.container.width()/2-this.loadingMessage.width()/2}),this.loadingMessage.show()):a=="editing"?(this.editingMessage.css({left:this.container.width()/2-this.editingMessage.width()/2}),this.editingMessage.show()):a=="deleting"&&(this.deletingMessage.css({left:this.container.width()/2-this.deletingMessage.width()/2}),this.deletingMessage.show())};
siggyMap.prototype.hideMessage=function(a){a=="loading"?this.loadingMessage.hide():a=="editing"?this.editingMessage.hide():a=="deleting"&&this.deletingMessage.hide()};
siggyMap.prototype.updateMessagePositions=function(){this.loadingMessage.is(":visible")&&this.loadingMessage.css({top:this.container.height()/2-this.loadingMessage.height()/2,left:this.container.width()/2-this.loadingMessage.width()/2});this.editingMessage.is(":visible")&&this.editingMessage.css({left:this.container.width()/2-this.editingMessage.width()/2});this.deletingMessage.is(":visible")&&this.deletingMessage.css({left:this.container.width()/2-this.deletingMessage.width()/2})};
siggyMap.prototype.centerButtons=function(){var a=30;this.buttonsContainer!=null&&($("#chainPanTrackX").is(":visible")&&(a+=20),this.buttonsContainer.css({left:this.container.width()/2-this.buttonsContainer.width()/2,bottom:a+"px"}))};
siggyMap.prototype.initialize=function(){var a=this;this.container=$("#chainMapContainer");this.r=Raphael("chainMap",this.container.width(),400);this.r.setViewBox(0,0,this.container.innerWidth(),400,!0);$("#chainMap").mousedown(function(b){if(a.massDelete&&!a.massSelect){a.massSelect=!0;var c=$("#chainMap").offset();a.initialCoordX=b.pageX-c.left+a.panX;a.initialCoordY=b.pageY-c.top}});$("#chainMap").mousemove(function(b){if(a.massSelect){var c=$("#chainMap").offset(),e=b.pageX-c.left+a.panX;b=b.pageY-
c.top;var d=c=0,f=0,g=0;e>a.initialCoordX?(d=a.initialCoordX,f=e-a.initialCoordX):(d=e,f=a.initialCoordX-e);b>a.initialCoordY?(c=a.initialCoordY,g=b-a.initialCoordY):(c=b,g=a.initialCoordY-b);a.massSelectBox?a.massSelectBox.attr({x:d,y:c,width:f,height:g}):(a.massSelectBox=a.r.rect(d,c,f,g,5),a.massSelectBox.attr({fill:"#000000","fill-opacity":0.4}))}});$(window).mouseup(function(){if(a.massSelect){a.massSelect=!1;for(var b=a.massSelectBox.getBBox(),c=a.drawnConnections.length-1;c>=0;c--){var e=!1,
d=a.drawnConnections[c],f=d.line.bgRef.getBBox();if(f.x<b.x&&f.x+f.width>b.x||b.x<f.x&&b.x+b.width>f.x)if(f.y>b.y&&f.y<b.y+b.height||b.y>f.y&&b.y<f.y+f.height)e=!0;if(e)d.line.deleteMe?(d.line.deleteMe=!1,d.line.attr("stroke",a.getMassColor(parseInt(a.wormholes[d.line.hash].mass))),d.line.bgRef.attr("stroke",a.getTimeColor(parseInt(a.wormholes[d.line.hash].eol)))):(d.line.attr("stroke","#006AFE"),d.line.bgRef.attr("stroke","#006AFE"),d.line.deleteMe=!0)}a.massSelectBox.remove();a.massSelectBox=null}});
this.loadingMessage=this.container.find("p.loading");this.editingMessage=this.container.find("p.editing");this.deletingMessage=this.container.find("p.deleting");this.buttonsContainer=this.container.find("p.buttons");this.showMessage("loading");$(window).bind("resize",function(){a.r.setSize(a.container.innerWidth(),400);a.updatePan();a.updateMessagePositions();a.centerButtons()});a=this;$("#chainMapSave").click(function(){var b=[],c;for(c in a.drawnSystems){var e={};e.id=a.drawnSystems[c].systemID;
e.x=a.drawnSystems[c].attr("x");e.y=a.drawnSystems[c].attr("y");b.push(e)}$.post(a.baseUrl+"dochainMapSave",{systemData:JSON.stringify(b)});a.editing=!1;$(this).hide();$("#chainMapOptions").data("disabled",!1);a.hideMessage("editing");if(a.infoicon!=null)a.infoicon.disabled=!1});$("#chainMapContainer h2").click(function(){a.mapOpen==1?(a.mapOpen=0,$("#chainMapInner").hide(),$("#chainMapec").text("Click to show"),$("#chainPanTrackX").hide(),a.r.clear(),a.lastUpdate=0,setCookie("mapOpen",0,365)):(a.mapOpen=
1,$("#chainMapInner").show(),$("#chainMapec").text("Click to hide"),setCookie("mapOpen",1,365),a.showMessage("loading"))});$("#chainMapBroadcast").click(function(){a.broadcast==1?(a.broadcast=0,setCookie("broadcast",0,365),$("#broadcastText").text("Location broadcasting is disabled."),$(this).text("Enable")):(a.broadcast=1,setCookie("broadcast",1,365),$("#broadcastText").text("Location broadcasting is enabled."),$(this).text("Disable"))});this.setupEditor();menu=new siggyMenu({ele:"chainMapOptions",
dir:"up",optionCallbacks:{addWHManual:function(){a.resetWormholeEditor();a.openWHEditor("add")},massDeleteWHs:function(){a.showMessage("deleting");a.massDelete=!0;$("#chainMapOptions").data("disabled",!0);$("#chainMapMassDeleteConfirm").show();$("#chainMapMassDeleteCancel").show();a.centerButtons()},editWHMap:function(){a.editing=!0;$("#chainMapSave").show();a.centerButtons();$("#chainMapOptions").data("disabled",!0);if(a.infoicon!=null)a.infoicon.disabled=!0;a.showMessage("editing")}}});menu.initialize();
$("#chainMapMassDeleteConfirm").click(function(){for(var b=[],c=a.drawnConnections.length-1;c>=0;c--)if(a.drawnConnections[c].line.deleteMe)b.push(a.drawnConnections[c].line.hash),a.drawnConnections[c].line.deleteMe=!1,a.drawnConnections[c].line.remove(),a.drawnConnections[c].bg.remove();b.length>0&&$.post(a.baseUrl+"dochainMapWHMassDelete",{hashes:JSON.stringify(b)},function(){a.siggymain.updateNow()});a.hideMessage("deleting");a.massDelete=!1;$(this).hide();$("#chainMapMassDeleteCancel").hide();
$("#chainMapOptions").data("disabled",!1)});$("#chainMapMassDeleteCancel").click(function(){for(var b=0;b<a.drawnConnections.length;b++)a.drawnConnections[b].line.deleteMe=!1,a.drawnConnections[b].line.attr("stroke",a.getMassColor(parseInt(a.wormholes[a.drawnConnections[b].line.hash].mass))),a.drawnConnections[b].bg.attr("stroke",a.getTimeColor(parseInt(a.wormholes[a.drawnConnections[b].line.hash].eol)));a.hideMessage("deleting");a.massDelete=!1;$(this).hide();$("#chainMapMassDeleteConfirm").hide();
$("#chainMapOptions").data("disabled",!1)});this.initializeHorizontalPan();this.initializeTabs();$("#refreshJumpLog").click(function(){a.updateJumpLog(a.editingHash)});$(document).bind("siggy.switchSystem",function(b,c){a.setSelectedSystem(c);b.stopPropagation()})};siggyMap.prototype.initializeTabs=function(){var a=this;$("#whEdit").click(function(){a.setWHPopupTab("editor")});$("#jumpLog").click(function(){a.setWHPopupTab("jumpLog");a.updateJumpLog(a.editingHash)})};
siggyMap.prototype.setupEditor=function(){var a=this;$("#wormholeEditorDisconnect").click(function(){$.post(a.baseUrl+"dochainMapWHDisconnect",{hash:a.editingHash},function(){a.siggymain.updateNow()});$("#chainMapContainer").unblock()});var b=$("#wormholeEditor input[name=fromSys]");b.val("");b.attr("disabled",!1);b.autocomplete({url:a.baseUrl+"doautocompleteWH",minChars:2,showResult:function(a,b){return b[0]!=""?a+" ("+b[0]+")":a}});var c=$("#wormholeEditor input[name=toSys]");c.val("");c.attr("disabled",
!1);c.autocomplete({url:a.baseUrl+"doautocompleteWH",minChars:2,showResult:function(a,b){return b[0]!=""?a+" ("+b[0]+")":a}});var e=$("#wormholeEditor input[name=fromCurrent]");e.attr("disabled",!1);e.attr("checked",!1);var d=$("#wormholeEditor input[name=toCurrent]");d.attr("disabled",!1);d.attr("checked",!1);e.change(function(){$(this).is(":checked")?(b.attr("disabled",!0),d.attr("disabled",!0)):(b.attr("disabled",!1),d.attr("disabled",!1))});d.change(function(){$(this).is(":checked")?(c.attr("disabled",
!0),e.attr("disabled",!0)):(c.attr("disabled",!1),e.attr("disabled",!1))});$("#wormholeEditorSave").click(function(){var f={};a.editorMode=="edit"?(f={mode:"edit",hash:a.editingHash,eol:$("#wormholeEditor input[name=eol]:checked").val(),mass:$("#wormholeEditor select[name=mass]").val()},$.post(a.baseUrl+"dochainMapWHSave",f,function(){a.siggymain.updateNow()}),a.editorOpen=!1,$("#chainMapContainer").unblock()):(f={mode:"add",fromSys:b.val(),fromSysCurrent:e.is(":checked")?1:0,toSys:c.val(),toSysCurrent:d.is(":checked")?
1:0,eol:$("#wormholeEditor input[name=eol]:checked").val(),mass:$("#wormholeEditor select[name=mass]").val()},$.post(a.baseUrl+"dochainMapWHSave",f,function(b){parseInt(b.success)==1?(a.editorOpen=!1,$("#chainMapContainer").unblock(),a.siggymain.updateNow()):a.displayEditorErrors(b.dataErrorMsgs)}))});$("#jumpLogClose").click(function(){$("#chainMapContainer").unblock()});$("#wormholeEditorCancel").click(function(){$("#chainMapContainer").unblock()})};
siggyMap.prototype.setSelectedSystem=function(a){if(this.selectedSystemID!=a){if(this.selectedSystemRect!=null)this.selectedSystemRect.remove(),this.selectedSystemRect=null;if(typeof this.drawnSystems[a]!="undefined"){var b=this.drawnSystems[a].getBBox();this.selectedSystemRect=this.r.rect(b.x-5,b.y-5,b.width+10,b.height+10,2);this.selectedSystemRect.attr({stroke:"#fff","fill-opacity":0,"stroke-width":1,"stroke-dasharray":"."});this.selectedSystemRect.toBack()}else this.selectedSystemRect=null;this.selectedSystemID=
a}};function cancelMapPan(){$("html").unbind("dragstart.pb selectstart.pb mousemove.pb mouseup.pb mouseleave.pb")}siggyMap.prototype.updatePan=function(){this.r.setViewBox(this.panX,0,this.container.innerWidth(),400,!0);this.dragPanX(this.panX);this.computeScrollbars()};
siggyMap.prototype.initializeHorizontalPan=function(){var a=this,b=$("#chainPanBarX");b.bind("mousedown.pb",function(c){$("html").bind("dragstart.pb selectstart.pb",function(){return!1});b.addClass("panActive");var e=c.pageX-b.position().left;$("html").bind("mousemove.pb",function(b){a.dragPanX(b.pageX-e,!1)}).bind("mouseup.pb mouseleave.pb",cancelMapPan);return!1})};
siggyMap.prototype.dragPanX=function(a){var b=$("#chainPanBarX");if(a<0)a=0;else if(a>this.maxBarX)a=this.maxBarX;b.css("left",a);b=this.container.innerWidth()/(this.maxX+this.container.innerWidth());this.panX=a/b;this.r.setViewBox(this.panX,0,this.container.innerWidth(),400,!0)};
siggyMap.prototype.computeScrollbars=function(){var a=this.container.innerWidth()-1;this.maxX=this.getMaxX();var b=$("#chainPanBarX");a<this.maxX+70?($("#chainPanTrackX").show(),b.width(a*(a/(this.maxX+70))),this.maxBarX=a-b.width(),this.panXactive=!0):($("#chainPanTrackX").hide(),this.panXactive=!1,this.panX=0,this.r.setViewBox(0,0,this.container.innerWidth(),400,!0));b.width()+b.position().left>$("#chainPanTrackX").innerWidth()&&this.dragPanX($("#chainPanTrackX").innerWidth()-b.width())};
siggyMap.prototype.getMaxX=function(){var a=0,b;for(b in this.drawnSystems)this.drawnSystems[b].attr("x")>a&&(a=this.drawnSystems[b].attr("x"));return a};siggyMap.prototype.displayEditorErrors=function(a){var b=$("#wormholeEditor ul.errors");b.empty();b.show();for(var c=0;c<a.length;c++)b.append($("<li>").text(a[c]))};
siggyMap.prototype.resetWormholeEditor=function(){var a=$("#wormholeEditor ul.errors");a.empty();a.hide();a=$("#wormholeEditor input[name=fromCurrent]");a.attr("disabled",!1);a.attr("checked",!1);a=$("#wormholeEditor input[name=toCurrent]");a.attr("disabled",!1);a.attr("checked",!1);a=$("#wormholeEditor input[name=fromSys]");a.val("");a.attr("disabled",!1);a=$("#wormholeEditor input[name=toSys]");a.val("");a.attr("disabled",!1);$("#wormholeEditor select[name=mass]").val(0);$("#wormholeEditor input[name=eol]").filter("[value=0]").attr("checked",
!0)};siggyMap.prototype.update=function(a,b,c){if(!this.editing&&!this.massDelete)this.lastUpdate=a,this.systems=b,this.wormholes=c,this.r.clear(),this.selectedSystemRect=null,this.selectedSystem=0,this.drawnConnections=[],this.drawnSystems={},this.infoicon=null,this.draw(),this.updated=!0,this.hideMessage("loading")};
siggyMap.prototype.updateActives=function(a){if(typeof a!="undefined"){for(var b in this.drawnSystems)typeof a[b]!="undefined"?this.populateBlobBody(this.drawnSystems[b],b,a[b]):this.populateBlobBody(this.drawnSystems[b],b,""),this.populateBlobTitle(this.drawnSystems[b],this.systems[b].name,this.systems[b].displayName,this.systems[b].sysClass,this.systems[b].systemID,this.systems[b].effect,this.systems[b].special);for(b=this.drawnConnections.length;b--;)this.r.connection(this.drawnConnections[b])}};
siggyMap.prototype.isMapOpen=function(){return this.mapOpen};
siggyMap.prototype.updateJumpLog=function(a){var b=$("#jumpLogList");b.empty();var c=this;$.get(this.baseUrl+"getJumpLog",{whHash:a},function(a){a.totalMass=parseInt(a.totalMass);var d=roundNumber(a.totalMass/1E6,2);$("#totalJumpedMass").text(d);if(a.totalMass>0)for(var f in a.jumpItems){d=a.jumpItems[f];var g=roundNumber(parseInt(d.mass)/1E6,2),h="";c.settings.jumpLogCharNames&&(h=" - "+d.charName);var k="";c.settings.jumpLogTimes&&(k=siggymain.displayTimeStamp(d.time));var j="",i="";c.drawnSystems[d.origin].displayName!=
""&&(i=" ("+c.drawnSystems[d.origin].displayName+")");j+=c.drawnSystems[d.origin].systemName+i+" -> ";i="";c.drawnSystems[d.destination].displayName!=""&&(i=" ("+c.drawnSystems[d.destination].displayName+")");j+=c.drawnSystems[d.destination].systemName+i;d=$('<li><p style="float:left"><b>'+d.shipName+"</b>"+h+"<br />"+d.shipClass+"<br />"+k+'</p><p style="float:right">Mass: '+g+'mil</p><div class="clear"></div><div class="center">'+j+"</div></li>");b.append(d)}else b.append($("<li><b>No jumps recorded<b/></li>"))})};
siggyMap.prototype.editWormhole=function(a){this.editingHash=a;this.resetWormholeEditor();a="";this.drawnSystems[this.wormholes[this.editingHash].from].displayName!=""&&(a=" ("+this.drawnSystems[this.wormholes[this.editingHash].from].displayName+")");$("#whEditFrom").text(this.drawnSystems[this.wormholes[this.editingHash].from].systemName+a);a="";this.drawnSystems[this.wormholes[this.editingHash].to].displayName!=""&&(a=" ("+this.drawnSystems[this.wormholes[this.editingHash].to].displayName+")");
$("#whEditTo").text(this.drawnSystems[this.wormholes[this.editingHash].to].systemName+a);$("#wormholeEditor select[name=mass]").val(this.wormholes[this.editingHash].mass);$("#wormholeEditor input[name=eol]").filter("[value="+this.wormholes[this.editingHash].eol+"]").attr("checked",!0);this.openWHEditor("edit")};siggyMap.prototype.setWHPopupTab=function(a){a=="editor"?($("#wormholeEditor").show(),$("#jumpLogViewer").hide()):a=="jumpLog"&&($("#wormholeEditor").hide(),$("#jumpLogViewer").show());$("#wormholeTabs").show()};
siggyMap.prototype.openWHEditor=function(a){this.setWHPopupTab("editor");$("#chainMapContainer").block({message:$("#wormholePopup"),css:{border:"none",padding:"15px",background:"transparent",color:"inherit",cursor:"auto",textAlign:"left",width:"auto"},overlayCSS:{cursor:"auto"},centerX:!0,fadeIn:0,fadeOut:0});a=="edit"?($("#whEditorAdd").hide(),$("#whEditorEdit").show(),this.editorMode="edit"):($("#wormholeTabs").hide(),$("#whEditorAdd").show(),$("#whEditorEdit").hide(),this.editorMode="add");this.editorOpen=
!0};
siggyMap.prototype.draw=function(){if(typeof this.infoicon=="undefined"||this.infoicon==null){if($.browser.eveIGB)var a=6,b=-10;else $.browser.mozilla?(a=55,b=-25):(a=65,b=-1);this.infoicon=this.r.image(this.baseUrl+"/public/images/information.png",a,b,16,16)}var c=this;a=function(){if(c.editing){this.ox=this.type=="rect"?this.attr("x"):this.attr("cx");this.oy=this.type=="rect"?this.attr("y"):this.attr("cy");this.nameText.ox=this.nameText.attr("x");this.nameText.oy=this.nameText.attr("y");this.classText.ox=this.classText.attr("x");
this.classText.oy=this.classText.attr("y");if(typeof this.charText!="undefined"&&typeof this.charText!="undefined"&&this.charText!==null)this.charText.ox=this.charText.attr("x"),this.charText.oy=this.charText.attr("y");if(typeof this.effectIndicator!="undefined")this.effectIndicator.ox=this.effectIndicator.attr("cx"),this.effectIndicator.oy=this.effectIndicator.attr("cy");this.animate({"fill-opacity":0.5},500)}};move=function(a,b){if(c.editing){var d=this.type=="rect"?{x:this.ox+a,y:this.oy+b}:{cx:this.ox+
a,cy:this.oy+b};this.attr(d);this.systemID==c.selectedSystemID&&c.selectedSystemRect.attr({x:d.x-5,y:d.y-5});this.nameText.attr({x:this.nameText.ox+a,y:this.nameText.oy+b});this.classText.attr({x:this.classText.ox+a,y:this.classText.oy+b});this.test.attr({x:this.test.ox+a,y:this.test.oy+b});typeof this.charText!="undefined"&&typeof this.charText!="undefined"&&this.charText!==null&&this.charText.attr({x:this.charText.ox+a,y:this.charText.oy+b});this.test.attr({path:"M"+this.getBBox().x+","+(this.nameText.getBBox().y+
14)+"L"+(this.getBBox().x+this.getBBox().width)+","+(this.nameText.getBBox().y+14)});typeof this.effectIndicator!="undefined"&&this.effectIndicator.attr({cx:this.effectIndicator.ox+a,cy:this.effectIndicator.oy+b});for(d=c.drawnConnections.length;d--;)c.r.connection(c.drawnConnections[d]);c.r.safari()}};up=function(){c.editing&&(c.updatePan(),this.animate({"fill-opacity":1},500))};for(var e in this.systems){b=this.originX+parseInt(this.systems[e].x);var d=this.originY+parseInt(this.systems[e].y);if(b>
this.maxX)this.maxX=b;b=this.r.rect(b,d,70,30,4);this.populateBlobBody(b,this.systems[e].systemID,this.systems[e].actives);this.populateBlobTitle(b,this.systems[e].name,this.systems[e].displayName,this.systems[e].sysClass,this.systems[e].systemID,this.systems[e].effect,this.systems[e].special);b.drag(move,a,up);d="#676767";parseInt(this.systems[e].activity)==1?d="#03B807":parseInt(this.systems[e].activity)==2?d="#FFE205":parseInt(this.systems[e].activity)==3&&(d="#DE4444");b.attr({fill:"#fff",stroke:d,
"fill-opacity":1,"stroke-width":3,cursor:"pointer"});this.drawnSystems[this.systems[e].systemID]=b;this.drawnSystems[this.systems[e].systemID].systemID=this.systems[e].systemID;this.drawnSystems[this.systems[e].systemID].systemName=this.systems[e].name;this.drawnSystems[this.systems[e].systemID].displayName=this.systems[e].displayName;b.click(function(){if(c.editing||c.massDelete)return!1;c.siggymain.switchSystem(this.systemID,this.systemName)})}for(var f in this.wormholes)if(e=this.wormholes[f],
!(typeof this.drawnSystems[e.from]=="undefined"||typeof this.drawnSystems[e.to]=="undefined"))a=this.r.connection(this.drawnSystems[e.from],this.drawnSystems[e.to],this.getMassColor(parseInt(e.mass)),this.getTimeColor(parseInt(e.eol))+"|12"),a.line.hash=f,a.line.bgRef=a.bg,a.line.deleteMe=!1,a.line.click(function(){c.massDelete?this.deleteMe?(this.deleteMe=!1,this.attr("stroke",c.getMassColor(parseInt(c.wormholes[this.hash].mass))),this.bgRef.attr("stroke",c.getTimeColor(parseInt(c.wormholes[this.hash].eol)))):
(this.attr("stroke","#006AFE"),this.bgRef.attr("stroke","#006AFE"),this.deleteMe=!0):c.editWormhole(this.hash)}),e.eolToggled=parseInt(e.eolToggled),e.eolToggled!=0&&this.setUpWHToolTip(a,e.eolToggled),this.drawnConnections.push(a);c.updatePan()};
siggyMap.prototype.populateBlobTitle=function(a,b,c,e,d,f){f=parseInt(f);var g=this;if(typeof a!="undefined"){if(typeof a.classText=="undefined"){e=parseInt(e);var h="#000000";switch(e){case 1:case 2:case 3:h="#2783D9";break;case 4:case 5:h="#FF9308";break;case 6:h="#FF0D0D";break;case 7:h="#259900";break;case 8:h="#FF9308";break;case 9:h="#FF0D0D";break;default:h="#000000"}a.classText=this.r.text(a.attr("x")+3,a.attr("y")+8,e==7?"H":e==8?"L":e==9?"0.0":c==""?"C"+e:"");a.classText.attr({"font-size":11,
"font-weight":"bold","font-style":"italic"});a.classText.attr({"text-anchor":"start"});a.classText.attr({fill:h})}cBB=a.classText.getBBox();e=cBB.width;if(cBB.x==0)cBB.x=a.attr("x")+3;if(typeof a.nameText=="undefined")a.nameText=this.r.text(cBB.x+cBB.width+2,a.attr("y")+8,c!=""?c:b),a.nameText.attr({"font-size":12,"font-weight":"bold"}),a.nameText.attr({"text-anchor":"start",cursor:"pointer"}),a.nameText.systemID=d,a.nameText.click(function(){g.editing||($.browser.eveIGB?CCPEVE.showInfo(5,this.systemID):
window.open("http://evemaps.dotlan.net/system/"+b,"_blank"))}),e+=a.nameText.getBBox().width;if(f!=0&&typeof a.effectIndicator=="undefined"){a.effectIndicator=this.r.circle(a.nameText.getBBox().x+a.nameText.getBBox().width+8,a.attr("y")+8,4);switch(f){case 30574:c="pink";d="Magnetar";break;case 30575:c="#000";d="Black Hole";break;case 30576:c="red";d="Red Giant";break;case 30577:c="blue";d="Pulsar";break;case 30669:c="orange";d="Wolf-Rayet";break;case 30670:c="yellow";d="Cataclysmic Variable";break;
default:c="#fff",d="No effect"}a.effectIndicator.attr({stroke:"#000",fill:c});e+=a.effectIndicator.getBBox().width+2;this.setUpBoxedToolTip(a.effectIndicator,d)}a.nameText.tooltip(this.infoicon);e>a.getBBox().width-7&&a.attr({width:e+10});typeof a.test!="undefined"&&a.test.remove();a.test=this.r.path("M"+a.getBBox().x+","+(a.nameText.getBBox().y+14)+"L"+(a.getBBox().x+a.getBBox().width)+","+(a.nameText.getBBox().y+14));a.test.attr({stroke:"grey","stroke-width":"1px"})}};
siggyMap.prototype.populateBlobBody=function(a,b,c){if(typeof a!="undefined"){var e=0,d="";if(typeof c!="undefined"&&c!=""){c=c.split(",");for(var f=0;f<c.length;f++)e+=11,d+=c[f]+"\n"}c=a.getBBox();d!=""&&typeof a.charText=="undefined"?(a.charText=this.r.text(a.attr("x")+4,a.attr("y")+27,""),a.charText.attr({"text-anchor":"start"}),a.charText.attr({"font-size":10}),a.charText.attr({text:d}),a.charText.attr({y:a.attr("y")+a.charText.getBBox(!0).height/2+15}),a.attr({height:30+e}),a.charText.getBBox().width>
c.width-4&&a.attr({width:a.charText.getBBox().width+10})):typeof a.charText!="undefined"&&(d!=""?(a.charText.attr({text:d}),a.charText.attr({y:a.attr("y")+a.charText.getBBox(!0).height/2+15}),a.attr({height:30+e}),a.charText.getBBox().width>c.width-4&&a.attr({width:a.charText.getBBox().width+10})):(a.charText.remove(),delete a.charText,a.attr({width:70,height:30})));if(b!=""&&this.selectedSystemID==b)a=a.getBBox(),this.selectedSystemRect!=null?this.selectedSystemRect.attr({x:a.x-5,y:a.y-5,width:a.width+
10,height:a.height+10}):this.selectedSystemRect=this.r.rect(a.x-5,a.y-5,a.width+10,a.height+10,2),this.selectedSystemRect.attr({stroke:"#fff","fill-opacity":0,"stroke-width":1,"stroke-dasharray":"."}),this.selectedSystemRect.toBack()}};
siggyMap.prototype.setUpBoxedToolTip=function(a,b){var c=0;c=$.browser.eveIGB?6:$.browser.mozilla?40:55;var e=this.r.text(c,-8,b).attr("fill","#fff");c=this.r.rect(c-2,-16,e.getBBox().width+4,16).attr({fill:"#262626"});e.attr({"text-anchor":"start"});var d=this.r.set();d.push(c,e);a.tooltip(d)};siggyMap.prototype.setUpWHToolTip=function(a,b){this.setUpBoxedToolTip(a.line,"EOL set at: "+siggymain.displayTimeStamp(b))};
siggyMap.prototype.getMassColor=function(a){var b="#676767";a==1?b="#e2cb06":a==2&&(b="#9a0808");return b};siggyMap.prototype.getTimeColor=function(a){var b="#3d3d3d";a==1&&(b="#FF17FE");return b};
